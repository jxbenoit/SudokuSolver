<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <title>Sudoku Solver</title>
  <style>
    * {
      -webkit-box-sizing:border-box;
      -moz-box-sizing:border-box;
      box-sizing:border-box;
    }
    html {
      height: 100%;
      width: 100%;
    }
    body {
      height: 100%;
      margin: 0;
      background-color: #ffffff;
    }
    body > * {
      text-align:center;
      margin:auto;
      font-family:Arial,Helvetica;
    }
    h2, h3, h4 {
      margin-bottom:0em;
      margin-top:0em;
    }
    #header {
      padding-top:1em;
      height:54px;
      border-bottom:2px solid #777;
      -webkit-box-shadow:3px 3px 5px 6px #777; /*Safari 3-4, iOS 4.0.2 - 4.2, Android 2.3+*/
      -moz-box-shadow:   3px 3px 5px 6px #777; /*Firefox 3.5 - 3.6*/
      box-shadow:        3px 3px 5px 6px #777; /*Opera 10.5, IE9, Firefox 4+, Chrome 6+, iOS 5*/
    }
    .Board {
      margin:1em auto 1em auto;
      padding:0;
      border:solid 1px silver;
      border-collapse: collapse;
      border-spacing: 0;
    }
    .Board tr {
      margin:0;
      padding:0;
      border:solid 1px silver;
    }
    .Board tr td {
      margin:0;
      padding:0;
      border:solid 1px silver;
    }
    .Board tr td input {
      margin:0;
      padding:0;
      text-align:center;
      font-family: Arial,Helvetica,sans-serif;
      font-size:18pt;
      width:30px;
      height:30px;
    }
    .btn {
      margin: auto 1% auto 1%;
      width:100pt; /*8%;*/
      padding:2px;
      font-size:13pt;
      color:white;
      background-color:DodgerBlue;
      border-radius:7px;
      -webkit-box-shadow:1px 1px 1px 1px #777; /*Safari 3-4, iOS 4.0.2 - 4.2, Android 2.3+*/
      -moz-box-shadow:   1px 1px 1px 1px #777; /*Firefox 3.5 - 3.6*/
      box-shadow:        1px 1px 1px 1px #777; /*Opera 10.5, IE9, Firefox 4+, Chrome 6+, iOS 5*/
    }
    #fake_btn {
      visibility:hidden;
    }
    #clear_btn {
      visibility:hidden;
    }
    .btns {
      margin-top:10pt;
      width:100%;
      height:36pt;
    }
    #messages {
      padding-top:10px;
      font-size:14pt;
      color:black;
    }
  </style>
  <script type='text/javascript'>
    var Grid, Digits;

    //-------------------------------------------------------------------------
    window.onload = function() {
      SetUpBoard();
      Clear();
        
    };//Onload

    //-------------------------------------------------------------------------
    function SetUpBoard() {
      let div = document.getElementById( "board_area" );

      let table = document.createElement( "TABLE" );
      for( let i = 0; i < 9; i++ ) {
        let tr = document.createElement( "TR" );

        if( i == 0 )
          tr.style.borderTop = "solid 3px black";
        if( (i+1) % 3 == 0 )
          tr.style.borderBottom = "solid 3px black";

        for( let j = 0; j < 9; j++ ) {
          let td = document.createElement( "TD" );

          if( j == 0 )
            td.style.borderLeft = "solid 3px black";
          if( (j+1) % 3 == 0 )
            td.style.borderRight = "solid 3px black";

          let input = document.createElement( "INPUT" );
          input.setAttribute( "maxlength", 1 );
          input.setAttribute( "pattern", "'^[abc]$'" );
          input.oninput = function() {
              if( ! parseInt(this.value) )
                this.value = "";
            };

          let cell_name = "cell_" + i + '' + j;
          input.id = cell_name;

          td.appendChild( input );
          tr.appendChild( td );
        }

        table.className = "Board";
        table.appendChild( tr );
      }

      div.appendChild( table );
    } //SetUpBoard

    //-------------------------------------------------------------------------
    function ResetBoard() {
      for( let i = 0; i < 9; i++ ) {
        for( let j = 0; j < 9; j++ ) {
          let cell_name = "cell_" + i + '' + j;
          document.getElementById( cell_name ).value = "";
        }
      }
    } //ResetBoard

    //-------------------------------------------------------------------------
    function LockBoard() {
      for( let i = 0; i < 9; i++ ) {
        for( let j = 0; j < 9; j++ ) {
          let cell_name = "cell_" + i + '' + j;
          document.getElementById( cell_name ).readOnly = true;
        }
      }
    } //LockBoard

    //-------------------------------------------------------------------------
    function UnlockBoard() {
      for( let i = 0; i < 9; i++ ) {
        for( let j = 0; j < 9; j++ ) {
          let cell_name = "cell_" + i + '' + j;
          document.getElementById( cell_name ).readOnly = false;
        }
      }
    } //UnlockBoard

    //-------------------------------------------------------------------------
    function Clear() {
      ResetBoard();
      UnlockBoard();

      document.getElementById( "messages" ).innerHTML =
        "Enter digits into the grid above or press the 'Show Example' button, <br />" +
        "then press the 'Solve' button.";

      document.getElementById( "clear_btn" ).style.visibility = "hidden";
    } //Clear

    //-------------------------------------------------------------------------
    function ShowMessage( Msg ) {
      UnlockBoard();

      document.getElementById( "messages" ).innerHTML = Msg;

      document.getElementById( "clear_btn" ).style.visibility = "visible";
    } //ShowMessage

    //-------------------------------------------------------------------------
    function Solve() {
      LockBoard();

      //Set up grid.
      Grid = MakeNewGrid();

      //Set up digits array.
      Digits = MakeNewDigitsArray();
      for( let i = 0; i < 9; i++ ) {
        for( let j = 0; j < 9; j++ ) {
          let cell_name = "cell_" + i + '' + j;
          let value = document.getElementById( cell_name ).value;
          if( value != '' && ! isNaN(value) ) {
            console.log( "Solve 1: Setting value for ("+i+", "+j+") to "+
                         value );
            SetValue( Grid, Digits, i+1, j+1, value, true );
          }
          else
            Grid[i][j] = null;
        }
      }

      //Find one of the easiest cells to solve.
      let Cell = { I:null, J:null };
      let LowestDigitsCount = 10;
      for( let i = 0; i < 9; i++ ) {
        for( let j = 0; j < 9; j++ ) {
          if( Grid[i][j] == null ) {
            let count = 0, last_value;
            for( let k = 0; k < 9; k++ ) {
              if( Digits[i][j][k] == true ) {
                count++;
                last_value = k + 1;
              }
            }

            //If no eligible digits for this cell, the grid is invalid.
            if( count == 0 ) {
              ShowMessage( "The grid is not solvable. " +
                           "Edit it, clear it, or try an example. " +
                           "Then try solving it again." );
              return;
            }
            else if( count == 1 ) {  //Only one possible value for the cell
              //Test setting this value.
              SetValue( Grid, Digits, i+1, j+1, last_value );

              //Check if this newly-set value is valid in the grid.
              if( ! IsValidRow(i) ||
                  ! IsValidCol(j) ||
                  ! IsValidBlock((i/3*3+j/3)) ) {
                return;
              }

              //It's good -- permanently set the value.
              SetValue( Grid, Digits, i+1, j+1, last_value, true );
            }
            else if( count < LowestDigitsCount ) {
              LowestDigitsCount = count;
              Cell.I = i;
              Cell.J = j;
            }
          }
        }
      }

      if( LowestDigitsCount == 10 ) {
        //No cells left with digits to determine. All cells are set.
        ShowMessage( "Solved!" );
        return;
      }

      //Go through possible values for the selected cell.
      let TempGrid = new Array(9).fill( new Array(9).fill(null) );

      let TempDigits = new Array(9).fill(
                        new Array(9).fill(
                         new Array(9).fill(true) ) );

      for( let k = 0; k < 9; k++ ) {
        if( Digits[Cell.I][Cell.J][k] ) {
          CopyGrid( Grid, TempGrid );
          CopyDigitsArray( Digits, TempDigits );

      //Test setting this value.
      SetValue( TempGrid, TempDigits, Cell.I+1, Cell.J+1, k+1, true );

//       //Check if this newly-set value is valid in the grid.
//       int  bad_val;
//       if( ! IsValidRow(Grid, Cell.I, bad_val) ||
//           ! IsValidCol(Grid, Cell.J, bad_val) ||
//           ! IsValidBlock(Grid, (Cell.I/3*3+Cell.J/3), bad_val) ) {
//         //Delete temporary grid.
//         for( int i = 0; i < 9; i++ )
//           delete [] TempGrid[i];
//         delete [] TempGrid;
// 
//         for( int i = 0; i < 9; i++ ) {
//           for( int j = 0; j < 9; j++ )
//             delete [] TempDigits[i][j];
//           delete [] TempDigits[i];
//         }
//         delete [] TempDigits;
// 
//         return false;
//       }
// 
// ShowGrid(TempGrid); //AAA
// char a;             //AAA
// cin >> a;           //AAA
// 
//       if( Solve(TempGrid, TempDigits) ) {
//         CopyGrid( TempGrid, Grid );
//         CopyDigitsArray( TempDigits, Digits );
// 
//         //Delete temporary grid.
//         for( int i = 0; i < 9; i++ )
//           delete [] TempGrid[i];
//         delete [] TempGrid;
// 
//         for( int i = 0; i < 9; i++ ) {
//           for( int j = 0; j < 9; j++ )
//             delete [] TempDigits[i][j];
//           delete [] TempDigits[i];
//         }
//         delete [] TempDigits;
// 
//         return true;
//       }
        }
      }  //End loop through k
/*

  //Delete temporary grid.
  for( int i = 0; i < 9; i++ )
    delete [] TempGrid[i];
  delete [] TempGrid;

  for( int i = 0; i < 9; i++ ) {
    for( int j = 0; j < 9; j++ )
      delete [] TempDigits[i][j];
    delete [] TempDigits[i];
  }
  delete [] TempDigits;

  return false;
*/
      UnlockBoard();
    } //Solve

    //-------------------------------------------------------------------------
    function ShowExample( Cell ) {
    } //ShowExample

    //-------------------------------------------------------------------------
    function PrintGrid( Grid ) {
      for( let i = 0; i < 9; i++ ) {
        let line;
        if( i == 0 ) {  //Write column headers
          line += "  ";
          for( let j = 1; j <= 9; j++ ) {
            line += j + ' ';
            if( j % 3 == 0 )
              line += ' ';
          }
          console.log( line );
        }

        if( i % 3 == 0 ) {         //Write row dividers
          line = "  ";
          for( let j = 0; j < (9*2)+2; j++ )
            line += "-";
          console.log( line );
        }

        line = (i+1);
        for( let j = 0; j < 9; j++ ) {
          if( j % 3 == 0 ) line += '|';
          if( Grid[i][j] == null )
            line += ". ";
          else
            line += Grid[i][j] + ' ';
        }
        console.log( line );
      }
    } //PrintGrid

    //-------------------------------------------------------------------------
    function SetValue( Grid, Digits, Row, Col, Value, Permanent=false ) {
      if( Row >= 1 && Row <= 9 && Col >= 1 && Col <= 9 ) {
        if( Value >= 1 && Value <= 9 ) {
          Grid[Row-1][Col-1] = Value;

          if( Permanent ) {
            console.log( "SetValue 1: Working on cell (" +
                         (Row-1) + ", " + (Col-1) + ")" );

            //Remove any other possible value for this cell.
            for( let k = 0; k < 9; k++ ) {
              if( k == Value-1 )
                Digits[Row-1][Col-1][k] = true;
              else
                Digits[Row-1][Col-1][k] = false;
            }

// for( let k = 0; k < 9; k++ )
//   console.log( Digits[0][0][k] );
            //Remove value in other col cells.
            for( let i = 0; i < 9; i++ )
              if( i != Row-1 )
                Digits[i][Col-1][Value-1] = false;

            //Remove value in other row cells.
            for( let j = 0; j < 9; j++ )
              if( j != Col-1 )
                Digits[Row-1][j][Value-1] = false;

            //Remove value in other block cells.
            let m = (Row-1) / 3 * 3;
            let n = (Col-1) / 3 * 3;
            for( let i = m; i < m+3; i++ ) {
              for( let j = n; j < n+3; j++ ) {
                if( i != Row-1 || j != Col-1 ) {
                  Digits[i][j][Value-1] = false;
                }
              }
            }
          }

          return true;
        }
        else
          console.log( "SetValue: ** Invalid digit value! " +
                       "Please try again. (" + Value + ")**" );
      }
      else
        console.log( "SetValue: ** Coordinates are out-of-bounds! " +
                     "Please try again. (" + Row + ", " + Col + ")**" );

      return false;
    } //SetValue

    //-------------------------------------------------------------------------
    function IsValidRow( Index ) {
      let Value;
      let seen = new Array(9);
      for( let k = 0; k < 9; k++ )
        seen[k] = false;

      for( let j = 0; j < 9; j++ ) {
        Value = Grid[Index][j];
        if( Value != null ) {
          if( ! seen[Value-1] )
            seen[Value-1] = true;
          else
            return false;
        }
      }

      return true;
    } //IsValidRow

    //-------------------------------------------------------------------------
    function IsValidCol( Index ) {
      let seen = new Array(9);
      for( let k = 0; k < 9; k++ )
        seen[k] = false;

      for( let i = 0; i < 9; i++ ) {
        Value = Grid[i][Index];
        if( Value != null ) {
          if( ! seen[Value-1] )
            seen[Value-1] = true;
          else
            return false;
        }
      }

      return true;
    } //IsValidRow

    //-------------------------------------------------------------------------
    function IsValidBlock( Index ) {
      let seen = new Array(9);
      for( let k = 0; k < 9; k++ )
        seen[k] = false;

      for( let i = 0; i < 3; i++ ) {
        for( let j = 0; j < 3; j++ ) {
          Value = Grid[Index/3*3+i][Index%3*3+j];
          if( Value != null ) {
            if( ! seen[Value-1] )
              seen[Value-1] = true;
            else
              return false;
          }
        }
      }

      return true;
    } //IsValidBlock

    //-------------------------------------------------------------------------
    function MakeNewGrid() {
      let Grid = [];
      for( let i = 0; i < 9; i++ ) {
        Grid[i] = [];
        for( let j = 0; j < 9; j++ )
          Grid[i][j] = null;
      }
      return Grid;
    } //MakeNewGrid

    //-------------------------------------------------------------------------
    function MakeNewDigitsArray() {
      let Digits = [];
      for( let i = 0; i < 9; i++ ) {
        Digits[i] = [9];
        for( let j = 0; j < 9; j++ ) {
          Digits[i][j] = [];
          for( let k = 0; k < 9; k++ )
            Digits[i][j][k] = true;    //Candidate digits for each cell
        }
      }
      return Digits;
    } //MakeNewDigitsArray

    //-------------------------------------------------------------------------
    function CopyGrid( Grid1, Grid2 ) {
      for( let i = 0; i < 9; i++ )
        for( let j = 0; j < 9; j++ )
          Grid2[i][j] = Grid1[i][j];
    } //CopyGrid

    //-------------------------------------------------------------------------
    function CopyDigitsArray( Digits1, Digits2 ) {
      for( let i = 0; i < 9; i++ )
        for( let j = 0; j < 9; j++ )
          for( let k = 0; k < 9; k++ )
            Digits2[i][j][k] = Digits1[i][j][k];
    } //CopyDigitsArray


/*
enum Dimensions { ROW, COL, BLOCK };

char ParseCommand( string s, int &Row, int &Col, int &Value );
bool CheckGrid( char** Grid, bool Verbose=false );
int  CountEmptyCells( char** Grid );

//===========================================================================
int main( int argc, char** argv ) {
  //Initialize grid & digits array.
  bool*** Digits = MakeNewDigitsArray();
  char** Grid = MakeNewGrid();

//AAA
//SetValue( Grid, Digits, 1, 5, 4, true );
//SetValue( Grid, Digits, 1, 6, 3, true );
//SetValue( Grid, Digits, 2, 3, 2, true );
//SetValue( Grid, Digits, 2, 6, 6, true );
//SetValue( Grid, Digits, 2, 9, 8, true );
//SetValue( Grid, Digits, 3, 4, 2, true );
//SetValue( Grid, Digits, 3, 7, 1, true );
//SetValue( Grid, Digits, 3, 8, 5, true );
//SetValue( Grid, Digits, 4, 2, 3, true );
//SetValue( Grid, Digits, 4, 3, 9, true );
//SetValue( Grid, Digits, 4, 5, 2, true );
//SetValue( Grid, Digits, 4, 7, 5, true );
//SetValue( Grid, Digits, 5, 3, 8, true );
//SetValue( Grid, Digits, 5, 4, 6, true );
//SetValue( Grid, Digits, 5, 5, 3, true );
//SetValue( Grid, Digits, 5, 6, 1, true );
//SetValue( Grid, Digits, 5, 7, 9, true );
//SetValue( Grid, Digits, 6, 3, 7, true );
//SetValue( Grid, Digits, 6, 5, 8, true );
//SetValue( Grid, Digits, 6, 7, 3, true );
//SetValue( Grid, Digits, 6, 8, 6, true );
//SetValue( Grid, Digits, 7, 2, 8, true );
//SetValue( Grid, Digits, 7, 3, 6, true );
//SetValue( Grid, Digits, 7, 6, 2, true );
//SetValue( Grid, Digits, 8, 1, 4, true );
//SetValue( Grid, Digits, 8, 4, 1, true );
//SetValue( Grid, Digits, 8, 7, 2, true );
//SetValue( Grid, Digits, 9, 4, 3, true );
//SetValue( Grid, Digits, 9, 5, 6, true );
SetValue( Grid, Digits, 1, 3, 7, true );
SetValue( Grid, Digits, 1, 7, 4, true );
SetValue( Grid, Digits, 1, 8, 6, true );
SetValue( Grid, Digits, 2, 2, 8, true );
SetValue( Grid, Digits, 2, 5, 9, true );
SetValue( Grid, Digits, 2, 6, 4, true );
SetValue( Grid, Digits, 2, 9, 2, true );
SetValue( Grid, Digits, 3, 5, 2, true );
SetValue( Grid, Digits, 3, 6, 1, true );
SetValue( Grid, Digits, 4, 1, 7, true );
SetValue( Grid, Digits, 4, 2, 6, true );
SetValue( Grid, Digits, 4, 7, 5, true );
SetValue( Grid, Digits, 5, 5, 4, true );
SetValue( Grid, Digits, 6, 3, 5, true );
SetValue( Grid, Digits, 6, 8, 2, true );
SetValue( Grid, Digits, 6, 9, 3, true );
SetValue( Grid, Digits, 7, 4, 4, true );
SetValue( Grid, Digits, 7, 5, 8, true );
SetValue( Grid, Digits, 8, 1, 1, true );
SetValue( Grid, Digits, 8, 4, 9, true );
SetValue( Grid, Digits, 8, 5, 7, true );
SetValue( Grid, Digits, 8, 8, 4, true );
SetValue( Grid, Digits, 9, 2, 9, true );
SetValue( Grid, Digits, 9, 3, 2, true );
SetValue( Grid, Digits, 9, 7, 3, true );
//AAA

  do {
    if( command == '?' )
      cout << "\nPlease enter the initial setup of the puzzle. Type:\n"
           << "  * 'a' - followed by a digit, then a pair of coordinates "
           << "(row, column) to add a digit.\n"
           << "          E.g. 'a 7 5 4' puts a '4' in the 7th row, 5th "
           << "column.\n"
           << "  * 'd' - followed by a pair of coordinates to delete a digit"
           << "\n"
           << "          E.g. 'd 3 8' deletes the digit (if there is one) in "
           << "the 3rd row, 8th column.\n"
           << "  * 'p' - to print the grid.\n"
           << "  * 's' - to solve the puzzle.\n"
           << "  * 'q' - to quit.\n"
           << "  * '?' - to display these instructions again." << endl;
    else if( command == 'p' )
      ShowGrid( Grid );
    else if( command == 'a' ) {
      SetValue( Grid, Digits, row, col, val, true );
    }
    else if( command == 'd' ) {
      if( row >= 1 && row <= 9 && col >= 1 && col <= 9 ) {
        Grid[row-1][col-1] = EMPTY;
        for( int k = 0; k < 9; k++ )
          Digits[row-1][col-1][k] = true;
      }
      else
        cout << "** Coordinates are out-of-bounds! Please try again. **"
             << endl;
    }

    if( command != 'a' && command != 'd' && command != 'p' &&
        command != 's' && command != '?' && command != 'q' ) {
      cout << "** Unrecognized command! Please try again. ** " << endl;
    }
    else if( command == 's' ) {
      //Check current grid setup is valid.
      if( ! CheckGrid(Grid, true) ) {
        cout << "** The current grid is invalid! Please check it and try "
             << "again. **" << endl;
        command = ' ';
      }
    }
  } while( command != 's' && command != 'q' );

  //Solve the puzzle.
  bool Solved = Solve( Grid, Digits );

  if( Solved ) {
    cout << "Solved!" << endl;
    ShowGrid( Grid );
  }
  else
    cout << "Sorry! The puzzle is unsolvable." << endl;

//---------------------------------------------------------------------------
bool CheckGrid( char** Grid, bool Verbose ) {
  //Check for invalid digit values.
  for( int i = 0; i < 9; i++ ) {
    for( int j = 0; j < 9; j++ ) {
      int val = Grid[i][j];
      if( val == EMPTY ) {}
      else if( val < 0 || val > 9 ) {
        if( Verbose )
          cout << "CheckGrid: ** Invalid value at (" << (i+1) << ", " << (j+1)
               << "): " << val << "! **" << endl;
        return false;
      }
    }
  }

  int val;

  //Check rows.
  for( int i = 0; i < 9; i++ ) {
    if( ! IsValidRow(Grid, i, val) ) {
      if( Verbose )
        cout << "CheckGrid: ** " << val << " appears more than once in "
             << "row " << (i+1) << "! **" << endl;
        return false;
    }
  }

  //Check columns.
  for( int j = 0; j < 9; j++ ) {
    if( ! IsValidCol(Grid, j, val) ) {
      if( Verbose )
        cout << "CheckGrid: ** " << val << " appears more than once in "
             << "column " << (j+1) << "! **" << endl;
      return false;
    }
  }

  //Check 3x3 blocks.
  for( int m = 0; m < 9; m++ ) {
    if( ! IsValidBlock(Grid, m, val) ) {
      if( Verbose )
        cout << "CheckGrid: ** " << val << " appears more than once in "
             << "a block" << "! **" << endl;
      return false;
    }
  }

  return true;
} //CheckGrid

//---------------------------------------------------------------------------
int  CountEmptyCells( char** Grid ) {
  int count = 0;
  for( int i = 0; i < 9; i++ )
    for( int j = 0; j < 9; j++ )
      if( Grid[i][j] == EMPTY )
        count++;

  return count;
} //CountEmptyCells

*/
  </script>
</head>
<body>
  <div id="header">
    <h2>Sudoku Solver</h2>
  </div>
  <div id="board_area"></div>
  <div id="messages">
  </div>
  <div id="btns">
    <input type="button" value="" id="fake_btn" class="btn"
           onclick=";" />
    <input type="button" value="Solve" id="solve_btn" class="btn"
           onclick="Solve();" />
    <input type="button" value="Show Example" id="example_btn" class="btn"
           onclick="ShowExample();" />
    <input type="button" value="Clear" id="clear_btn" class="btn"
           onclick="Clear();" />
  </div>
</body>
</html>
